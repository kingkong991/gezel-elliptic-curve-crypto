\tikzset {
	and/.style={draw, and gate US, logic gate inputs=nn, rotate=90, xscale=-1, thick, scale=0.8},
	labelbox/.style={draw, chamfered rectangle, chamfered rectangle corners={north east, south east}, chamfered rectangle angle=55, chamfered rectangle xsep=2cm, chamfered rectangle ysep=14pt/2, minimum height=14pt, minimum width=1.2cm, text width=1cm, inner sep=0pt, outer sep=0pt, text ragged},
	labelboxin/.style={labelbox, anchor=base},
	labelboxout/.style={labelbox, anchor=west},
	labelboxreg/.style={draw, minimum height=14pt, minimum width=2cm, outer sep=0pt},
	joint/.style={inner sep=0mm, outer sep=0pt, text height=0mm, text width=0mm, minimum height=0.15cm, fill, circle},
	bit/.style={thick, line cap=butt},
	multibit/.style={line width=2pt},
	nothing/.style={inner sep=0mm, outer sep=0pt, text width=0mm, text height=0mm, minimum width=0.8pt},
	labeltext/.style={text ragged},
	labeltextin/.style={labeltext, anchor=west, xshift=-6mm},
	labeltextout/.style={labeltext, anchor=west, xshift=0mm},
	labeltextreg/.style={labeltext, text centered},
	mux/.style={draw, trapezium, trapezium stretches=true, rotate=-90, inner sep=1pt, minimum height=12pt, minimum width=1.2cm, xshift=2.2mm, outer sep=0pt},
	adder/.style={draw, circle, inner sep=0pt, outer sep=0pt, minimum size=5mm, semithick},
	malucore/.style={draw, minimum height=1.4cm, minimum width=3cm, text width=2cm, text centered, semithick}
}

\def\labelboxregl#1#2#3{\node[labeltextreg, #3] {#2}; \node[labelboxreg, #3] (#1) {}; \draw (#1.north west) -- ($(#1.north west)!0.5!(#1.south west) + (2mm, 0)$) -- (#1.south west);}

\def\labelboxregr#1#2#3{\node[labeltextreg, #3] {#2}; \node[labelboxreg, #3] (#1) {}; \draw (#1.north east) -- ($(#1.north east)!0.5!(#1.south east) + (-2mm, 0)$) -- (#1.south east);}

\def\labelboxin#1#2{\node[labeltextin] {#2}; \node[labelboxin] (#1) {};}
\def\labelboxout#1#2#3{\node[labeltextout, #3] {#2}; \node[labelboxout, #3] (#1) {};}

\def\mux#1{\node[mux] (#1) {}; \node[xshift=-0.5pt, anchor=west] at (#1.south west) {1}; \node[xshift=-0.5pt, anchor=west] at (#1.south east) {0};}

\def\adder#1{\node[adder] (#1) {}; \draw [semithick] (#1.north) -- (#1.south) (#1.west) -- (#1.east);} 

\def\boxmalucore#1{\node[malucore] (#1) {\Large MALU Core};}

\begin{tikzpicture}
\matrix [column sep=1.5mm, row sep=1.5mm] {
	\labelboxin{i1}{start}; &[8mm]
	\node[joint] (j1) {}; &[6mm]
	\labelboxregl{r1}{start}{}; \\

	\labelboxin{i2}{mode}; &
	&
	\labelboxregl{r2}{mode}{}; \\

	\labelboxin{i3}{A}; &
	\mux{m1}; &
	\labelboxregl{r3}{A}{yshift=-2.2mm}; &[-3mm]
	\node[joint, yshift=-2.2mm] (j2) {}; \\

	&
	\node[joint] (j3) {}; \\

	\labelboxin{i4}{B}; &
	&
	\labelboxregl{r4}{B}{}; &
	\node[joint] (j4) {}; &
	\adder{a1}; &[4mm]
	\mux{m2}; &[8mm]
	\labelboxout{o1}{out}{yshift=-2.2mm}; \\[-2mm]

	&
	\node[and, yshift=-1.0mm] (a2) {}; &
	\labelboxregr{r5}{T}{}; &
	&
	\node[joint] (j5) {}; &
	&
	\labelboxout{o2}{ready}{}; \\

	&
	&
	\boxmalucore{mcore}; &
	&
	\node[nothing] (e1) {}; \\[1mm]

	&
	&
	\labelboxregr{r6}{m}{}; \\
};

\path[-]	(i1.east) edge [bit, line cap=rect] (j1.base)
			(j1.base) edge [bit] (r1.west)
			(j1.base) edge [bit] (m1.west)
			(i3.east) edge [multibit, line cap=rect] ($(i3.east)!0.5!(m1.south west)$)
			($(i3.east)!0.5!(m1.south west)$) edge [multibit] (m1.south west)
			(a1.east) edge [multibit] (m2.south west)
			(i4.east) edge [multibit, line cap=rect] ($(i4.east)!0.5!(r4.west)$)
			($(i4.east)!0.5!(r4.west)$) edge [multibit] (r4.west)
			(m1.north) edge [multibit] (r3.west)
			(r3.east) edge [multibit] (j2.base)
			(r4.east) edge [multibit] (j4.base)
			(j4.base) edge [multibit] (a1.west)
			(j3.base) edge [bit] (a2.input 1)
			(r5.east) edge [multibit] (j5.base)
			(m2.north) edge [multibit] (o1.west)
			(i2.east) edge [bit, line cap=rect] ($(i2.east)!0.5!(r2.west)$)
			($(i2.east)!0.5!(r2.west)$) edge [bit, line cap=butt] (r2.west);

\draw		[multibit] (j2.base) |- node[very near end, above, xshift=-3mm] {$\ll 1$} (j3.base) -| ($(m1.south east) + (-2mm, 0)$) |- (m1.south east)
			(j2.base) -| (a1.north)
			(j4.base) |- ($(r4.south west) + (0, -2mm)$) -| (a2.input 2)
			(a2.output) |- (mcore.west)
			(r5.west) -| ($(mcore.north west) + (-4mm, 0)$) |- ($(mcore.north west) + (0, -4mm)$)
			(j5.base) -| ($(e1.base) + (0, 3mm)$) |- ($(mcore.east) + (0, 3mm)$)
			(j5.base) |- (m2.south east);

\draw		[bit] (r6.west) -| ($(mcore.south west) + (-4mm, 0)$) |- ($(mcore.south west) + (0, 4mm)$)
			(r6.east) -| ($(e1.base) + (0, -3mm)$) |- ($(mcore.east) + (0, -3mm)$)
			(r2.east) -| (m2.west)
			(o2.west) -- ($(o2.west) + (-6mm, 0)$);

\draw[multibit, color=black!50] ($(i1.east)!0.4!(j1.base) + (0, 14pt)$) rectangle ($(r6.south east) + (2.5cm, -6pt)$);
\end{tikzpicture}
