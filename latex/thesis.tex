\documentclass[a4paper]{report}
\usepackage[dutch]{babel}   % Taal van het document (opmaakregels ed.)
\usepackage{graphicx}
\usepackage{color}

\usepackage{url}                % Opmaak van URLs
%\usepackage[official]{eurosym}  % Euro symbool
%\usepackage{colortbl}           % Kleur tabellen

\usepackage{nonfloat}            % Voeg non-floating tables & figures toe
\usepackage{pdfpages}            % Maak dat voorblad kan toegevoegd worden
\usepackage{amsmath,amsfonts}    % Wiskunde
\usepackage{listings}            % Code Listings

\usepackage{tikz}	% Graphics framework
\usetikzlibrary{positioning}
\usetikzlibrary{calc}

% Substring macro
\def\substring#1#2#3{%
  \expandafter\subm\romannumeral#3000x.{}#1\relax\relax{#2}}
\def\subm#1#2.#3#4\relax#5\relax{%
  \csname sub#1\endcsname#2.#4\relax#5#3\relax}
\def\subx#1.#2\relax#3\relax#4{%
  \expandafter\submb\romannumeral#4000x.{}{}#3\relax}
\def\submb#1#2.#3{\csname sub#1b\endcsname#2.}
\def\subxb#1.#2\relax{#2}

% Karnaugh map macro
% Takes 5 arguments:
%	- Number of variables
%	- Function description (not used right now)
%	- Variable names, if the name is more than 1 char, enclose in {}
%	- Output values, if not 1 char, again enclose in {}
%	- Tikz functions (eg. for drawing rectangles around the minimizations)
%
% Furthermore, for ease of use, each point on the grid (where 2 lines meet) has a 
% named node attached to it, starting with G0 at the top left, G1 to the right of it, etc.
%
% Should it be required, the output values are named as well, starting with I0, I1, ...

% Argument string macro shamelessly stolen from Andreas W. Wielands Karnaugh map code
\def\kmapargumentstring#1{\gdef\kmapdummystring{#1{}\noexpand\end}}
\def\kmapgetchar{\expandafter\kmapgetonechar\kmapdummystring}
\def\kmapgetonechar#1#2\end{{#1}\gdef\kmapdummystring{#2\noexpand\end}}%

% Some counters
\newcounter{karnaughgrid}
\newcounter{karnaughindex}

\newcounter{karnaughsize}
\newcounter{karnaughsizex}
\newcounter{karnaughsizey}

\newcommand{\kmap}[5]{%
\setcounter{karnaughsize}{#1}

\begin{tikzpicture}
	\setcounter{karnaughgrid}{0};
	\setcounter{karnaughindex}{0};

	\ifcase\value{karnaughsize}
		% Size 0
		\exit
	\or
		% Size 1
		\setcounter{karnaughsizex}{2}
		\setcounter{karnaughsizey}{1}
	\or
		% Size 2
		\setcounter{karnaughsizex}{2};
		\setcounter{karnaughsizey}{2};
	\or
		% Size 3
		\setcounter{karnaughsizex}{4}
		\setcounter{karnaughsizey}{2}
	\or
		% Size 4
		\setcounter{karnaughsizex}{4}
		\setcounter{karnaughsizey}{4}
	\else
		\exit	% Wrong size
	\fi

	% Background grid
	\draw	(0,0) grid (\arabic{karnaughsizex},\arabic{karnaughsizey});

	% Set named node at each grid point for ease of drawing boxes & text later
	\foreach \y in {\arabic{karnaughsizey},...,0} {
		\foreach \x in {0,...,\arabic{karnaughsizex}} {
			\node (G\arabic{karnaughgrid}) at (\x, \y) {};
			\addtocounter{karnaughgrid}{1};
		}
	}

	% Draw function name
	\node at ($(G0) + {\value{karnaughsizey}/2}*(-0.4, 0) + {\value{karnaughsizex}/2}*(0, 0.4)$) [left] {#2};

	% Set bounding box to current size for nicer centering
	%\useasboundingbox;

	% Counting starts at 0, so lower size counters
	\addtocounter{karnaughsizex}{-1};
	\addtocounter{karnaughsizey}{-1};

	\kmapargumentstring{#4}

	\foreach \y in {\arabic{karnaughsizey},...,0} {
		\foreach \x in {0,...,\arabic{karnaughsizex}} {
			\node (I\arabic{karnaughindex}) at (\x, \y) [above right=-0.05 and -0.05] {\tiny \arabic{karnaughindex}};
			\addtocounter{karnaughindex}{1};

			\node at (\x + 0.5, \y + 0.5) {\large \kmapgetchar};
		}
	}

	% Draw variable names
	\kmapargumentstring{#3}

	\ifcase\value{karnaughsize}
		% No zero size maps
	\or
		% Size 1 maps
		\draw[arrows=|-|] ($(node cs:name=G1, anchor=north) + (0, 0.1)$) -- node[above] (V1) {\kmapgetchar} ($(node cs:name=G2, anchor=north)  + (0, 0.1)$);
	\or
		% Size 2 maps
		\draw[arrows=|-|] ($(node cs:name=G1, anchor=north) + (0, 0.1)$) -- node[above] (V1) {\kmapgetchar} ($(node cs:name=G2, anchor=north)  + (0, 0.1)$);
		\draw[arrows=|-|] ($(node cs:name=G3, anchor=west) + (-0.1, 0)$) -- node[left] (V2) {\kmapgetchar} ($(node cs:name=G6, anchor=west)  + (-0.1, 0)$);
	\or
		% Size 3 maps
		\draw[arrows=|-|] ($(node cs:name=G2, anchor=north) + (0, 0.8)$) -- node[above] (V1) {\kmapgetchar} ($(node cs:name=G4, anchor=north)  + (0, 0.8)$);
		\draw[arrows=|-|] ($(node cs:name=G5, anchor=west) + (-0.1, 0)$) -- node[left] (V2) {\kmapgetchar} ($(node cs:name=G10, anchor=west)  + (-0.1, 0)$);
	\draw[arrows=|-|] ($(node cs:name=G1, anchor=north) + (0, 0.1)$) -- node[above] (V3) {\kmapgetchar} ($(node cs:name=G3, anchor=north)  + (0, 0.1)$);
	\else
		% Size 4 maps
		\draw[arrows=|-|] ($(node cs:name=G10, anchor=west) + (-1, 0)$) -- node[left] (V1) {\kmapgetchar} ($(node cs:name=G20, anchor=west)  + (-1, 0)$);
		\draw[arrows=|-|] ($(node cs:name=G2, anchor=north) + (0, 0.8)$) -- node[above] (V2) {\kmapgetchar} ($(node cs:name=G4, anchor=north)  + (0, 0.8)$);
		\draw[arrows=|-|] ($(node cs:name=G5, anchor=west) + (-0.1, 0)$) -- node[left] (V3) {\kmapgetchar} ($(node cs:name=G15, anchor=west)  + (-0.1, 0)$);
		\draw[arrows=|-|] ($(node cs:name=G1, anchor=north) + (0, 0.1)$) -- node[above] (V4) {\kmapgetchar} ($(node cs:name=G3, anchor=north)  + (0, 0.1)$);
	\fi

	% Draw extra stuff (like minimizations)
	#5
\end{tikzpicture}}

% Plaats van afbeeldingen
\graphicspath{{images/}}
\DeclareGraphicsExtensions{.pdf,.eps,.png}

% Stel paginastijl in
\pagestyle{headings}

% Zet hier de woorden waarmee de splitser problemen heeft:
\hyphenation{}

% Regel nummering van figuren
\renewcommand{\thefigure}{\thechapter.\arabic{figure}}
\newcommand{\Chapter}[1]{\chapter{#1} \setcounter{figure}{0}}

% Citatie commando voor figuren
\newcommand{\reffig}[1]{Fig.~\ref{#1}}

% Listings setup
\definecolor{darkkeyword}{rgb}{0,0.08,0.40} %Requires the color package.
\definecolor{gray}{gray}{0.7}

\lstdefinelanguage{gezel}{
  tabsize=3,
  frame=single,
  basicstyle=\footnotesize\ttfamily,
  rulecolor=\color{gray},
  identifierstyle=, % nothing happens
  commentstyle=\color{gray}, % red comments
  stringstyle=\color{gray},%\ttfamily, % typewriter type for strings
  showstringspaces={false}, % no special string spaces
  morecomment=[l]{//},
  morestring=[b]",
  morekeywords={always, dp, in, out, tc, ns, reg, sig, sfg, hardwired, sequencer,
                fsm, use, ipblock, ipparm, iptype, lookup, initial, state, system,
                if, then, else, stimulus},
                keywordstyle=\color{blue}\bfseries,classoffset=1,
  morekeywords={\$display, \$cycle, \$dec, \$bin, \$dp, \$finish,
                \$hex, \$sfg, \$trace, \$option},
                keywordstyle=\color{darkkeyword}\bfseries,classoffset=0
}

\lstset{language=gezel,
        showstringspaces=false,
        frameround=ftft,
        captionpos=b,
        xleftmargin=-1cm,
        xrightmargin=-1cm,
        numbers=left,
        numberstyle=\tiny,
        stepnumber=5,
        numberfirstline=true,
        firstnumber=1
}

\renewcommand*\lstlistlistingname{Lijst van listings}

% BibTex opmaak
\bibliographystyle{abbrvurl}

% Voorkom lelijke opmaak
\clubpenalty=8000
\widowpenalty=8000
\displaywidowpenalty=8000

\hyphenpenalty=5000
\tolerance=1000

%%% Code voor figuren %%%
%%% Plaatst figuur op huidige plaats %%%
%
%\vspace{\textfloatsep}
%\begin{minipage}{\linewidth}
%    \begin{center}
%    \includegraphics[width=311px]{fig}
%    \figcaption{Figuur uitleg}\label{Figuur label}
%    \end{center}
%    \end{minipage}
%\vspace{\textfloatsep}

\begin{document}

% Voeg voorblad toe
%\includepdf{voorblad.pdf}

% Reset counter & maak inhoudstafel
\setcounter{page}{1}
\tableofcontents
\listoffigures
\listoftables
\clearpage

% Include gedeelte (begint op nieuwe pagina
% Indien gewoon invoegen op huidige plaats \input

\include{inleiding}             % Inleiding
\include{encryptie-applicaties} % Encryptie - Applicaties van encryptie
\include{encryptie-wiskunde}    % Encryptie - Wiskundige achtergrond
\include{malu}                  % Modular Aritmitic Logical Unit - Design
\include{malu-pairings}         % MALU - Uitbreiding naar pairings
\include{malu-pairings-hw}      % MALU - Pairings hardware implementatie
\include{optimalisatie}         % MALU - Optimalisatie (& parallellisatie)
\include{tests}                 % MALU - Oppervlakte/snelheids tests
\include{side-channel-attacks}  % Side channel attack weerstand
\include{conclusie}             % Conclusie

\appendix                       % Start appendices

\include{code}                  % Implementatie code

% BibTex referenties
\bibliography{references}

% Lege achterpagina
\clearpage
\mbox{~}
\thispagestyle{empty}

\end{document}
